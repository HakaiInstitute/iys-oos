---
title: "2019 IYS - Salmon Diet Data wrangle"
author: "Tim van der Stap"
date: "7/15/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(janitor)
library(readxl)
library(worrms)
library(here)
library(parsedate)
library(googledrive)
library(uuid)
```

The raw data is stored on Google Drive. The first step is to download the file from Google Drive to a local folder on your computer's hard drive. 

``` {r file_download, eval = FALSE}
# Make sure your folder path exists already (e.g. ./Salmon Diet/raw_data)
drive_download("https://docs.google.com/spreadsheets/d/1E88ZXuiYIqjq4ABl2GDB7Kp0UAG-0tIM/edit#gid=2020388317", 
               path = here::here("Salmon Diet", "raw_data", 
                                 "GoA_fish diets_cleaned.xlsx"),
               overwrite = TRUE)
```

*** 

In a first step, we wanted to see if the data in the salmon diet dataset matches data recorded in the pathogen dataset. The reason for this is that in the pathogen dataset, Floytags and MGL# are attached to the samples, but this appears to be missing in the salmon diet dataset. By cross-referencing, we can gain insight as to which diet data belongs to which Floytag or MGL#. Therefore, we also downloaded the pathogen data. We found that there were some data entries (n=52 rows) where `Species`, `Trawl` and `Mass` data matches between the salmon diet data and the pathogen data, but most (n=96 rows) jad no match. Unfortunately this means that, in the current state, we cannot cross-reference the pathogen and salmon data for the majority of the fish, and consequently we are not able to use Floytag or MGL# as a common `parentEventID`. Therefore, we will use the dwc::associatedTaxa to link the stomach content (diet) a salmon individual (unique `occurrenceID`). 

***

# Event Core

When creating the different eventID layers, we assume that the column `Trawl` is synonymous to `Station`. Ideally, the salmon that were caught and dissected would have been given a Floytag or MGL#, so a distinction can be made between stomach content of different individuals of a same species in the same trawl. 

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">

Current problem: Multiple individuals of the same species were caught in a single trawl, however within the salmon diet dataset there is no column to indicate how these individual measurements are separate (i.e., no sampleID associated to each individual fish). Additionally, some species' stomach content seems to have been aggregated, whereas others haven't. Even within a single trawl record there is data specific to a single individual and aggregated data, _and sometimes of the same species_. 

</div>

``` {r data wrangle, eval = FALSE}
salmon <- read_excel(here("datasets", "GoA_2019", "Salmon Diet", "raw_data", 
                       "GoA_fish diets_cleaned.xlsx"), 
                  sheet = "Diets_clean") %>%
  janitor::clean_names() %>%
  mutate(project = "IYS",
         cruise = paste(project, "GoA2019", sep = "_"),
         station = paste(cruise, trawl, sep="_Stn"),
         trawl = paste(station, "trawl1", sep=":")
  )
```

No metadata is mentioned in the Salmon Diet data as to when and where the trawls took place. To connect coordinates, date and time to the `eventIDs` this information is taken from the Fish Trawl Abundance or Bridgelog datasheet. Right now I am saving both these files in the Salmon Diet folder, but once all folders and scripts have been QC'd the location/time can be read straight from the Trawl-specific folder. For now, I'm afraid it would cause confusion when committing/pushing to GitHub, as I do not have a finalized version of these datasheets yet. 

``` {r salmon_datetime, eval = FALSE}
drive_download(file = "https://docs.google.com/spreadsheets/d/1rtT6L5WSi_UiiXfoS95wnDqA8loc959T/edit#gid=668595086", 
               path = here::here("Salmon Diet", "raw_data", 
                                 "2019_GoA_Fish_data_Hakai.xlsx"),
               overwrite = TRUE)

trawl <- read_excel(here("datasets", "GoA_2019", "Salmon Diet", "raw_data", 
                         "2019_GoA_Fish_data_Hakai.xlsx")) %>%
  mutate(eventDate = format_iso_8601(as.POSIXct(UTC_start)),
         eventDate = str_replace(eventDate, "\\+00:00", "Z")) %>%
  mutate(station = paste("GoA2019", NUMBER, sep = "_Stn"))
```

**Please note that the date and coordinates could change as the trawl data is not finalized.** From an NPAFC document () we gather that the trawling was conducted at surface level, to a depth of 30 meters (confirm!). 

``` {r salmondiet_event, eval = FALSE}
salmon_project <- salmon %>%
  select(eventID = project) %>%
  distinct(eventID)

salmon_cruise <- salmon %>% 
  select(eventID = cruise,
         parentEventID = project) %>%
  distinct(eventID, .keep_all = TRUE) 

salmon_station <- salmon %>%
  select(eventID = station,
         parentEventID = cruise) %>% 
  distinct(eventID, .keep_all = TRUE) 

# Join date and coordinates to trawl. Remember that the date and coordinates are not from the Salmon Diet data sheet, but from the trawl data sheet. Minimum and maximum depth of the trawl be included here as well if the information becomes available. 
salmon_trawl <- salmon %>%
  left_join(select(
    trawl,
    station,
    eventDate,
    X,
    Y
  )) %>%
  dplyr::rename(eventID = trawl, 
                parentEventID = station,
                decimalLatitude = Y,
                decimalLongitude = X) %>%
  mutate(minimumDepthInMeters = 0,
         maximumDepthInMeters = 30,
         eventRemarks = "trawl") %>%
  distinct()

salmon_trawl <- salmon_trawl %>%
  mutate(footprintWKT = " ")
salmon_trawl$footprintWKT <- paste0("POINT (", salmon_trawl$decimalLongitude, " ",
                                     salmon_trawl$decimalLatitude, ")")

# The following bit of code is only necessary if we include salmon individuals in the Event Core, as a layer. 

predator <- salmon_trawl %>%
  mutate(eventID = paste(eventID, species, sep = ":")) %>%
  distinct()

predator$id <- " "

for(i in unique(predator$eventID)) {
  predator$id[predator$eventID == i] <- seq_len(sum(predator$eventID == i))
}

predator$eventID <- paste(predator$eventID, predator$id, sep = ":")

prey <- predator %>%
  select(-digested_food) %>%
  pivot_longer(cols = boreoteuthis_borealis:mictostomus_pacificus,
               names_to = "prey", 
               values_to = "presence")
prey <- prey[!is.na(prey$presence), ] 

for(i in unique(prey$eventID)) {
  prey$id[prey$eventID == i] <- seq_len(sum(prey$eventID == i))
}

prey$prey_id <- paste0("pr", prey$id)

spp_occ <- full_join(predator, prey)

salmon_sample <- spp_occ %>%
  dplyr::select(eventID,
                parentEventID,
                eventDate,
                decimalLatitude,
                decimalLongitude
                ) 

#salmon_sample <- salmon_sample %>% dplyr::select(-decimalLatitude, -decimalLongitude)

#coordinates <- obistools::calculate_centroid(salmon_sample$footprintWKT)
#salmon_sample <- cbind(salmon_sample, coordinates)

# The Salmon Diet data does not include information as to at what depths the trawls were conducted. Currently I believe this information is also not present in the general Trawl data. Should this information become available it should be connected to the general trawl information, along with info such as: volume water filter, speed at which the vessel was traveling during trawl, starting & finish lat/longs of trawl.
```

***

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">
The current dilemma I have is that there is no unique `sampleID` associated with each data entry in the salmon diet data. This makes it difficult to properly structure the dataset. The option we can have chosen is the following:

We connect the stomach content (prey) to the `occurrenceID` of the salmon individual through the `associatedTaxa` column. In doing so, we combine two occurrence tables within a single Occurrence Core.
</div>

Currently the data is reformatted data is structured as shown in **option A**. However, the data standardization is an evolving process so the structure might change. 

***

``` {r, eval = FALSE}

# If we treat every salmon entry for which the stomach has been removed and examined as a sampling event, we essentially treat the salmon like a sampling instrument of their direct surroundings! 

# To connect them all together: 
salmon_event <- bind_rows(salmon_cruise,salmon_station,salmon_trawl) %>%
  dplyr::select(eventID, parentEventID, eventDate, decimalLatitude, decimalLongitude, footprintWKT,
                minimumDepthInMeters, maximumDepthInMeters, eventRemarks) %>%
  mutate(type = "HumanObservation",
         geodeticDatum = "EPSG:4326",
         samplingProtocol = " ")

# Make sure the folder path exists already (e.g. ./Salmon Diet/tidy_data)
write_csv(salmon_event, here("Salmon Diet", "tidy_data", "salmon_event.csv"))
drive_upload(here("Salmon Diet", "tidy_data", "salmon_event.csv"),
             path = "https://drive.google.com/drive/u/0/folders/1pGd2cuvdb25QX7CGm2wC81Emh5O-LdbR",
             name = "salmon_event.csv",
             overwrite = TRUE)
```

# Occurrence Core

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">
How do the scientists know which individual the stomach content belong to, asides from their data?
</div>

The Occurrence core connected to each salmon stomach examined consists of the occurrences of prey species consumed by the salmon species at each station. The measurement attached to these unique occurrences is the mass (g) of each prey species consumed. Each prey species will receive their own unique URN from [WoRMS](http://www.marinespecies.org/), if identified.

As all the prey species are listed as columns, we first have to investigate all the unique prey species consumed, as these will get their associated WoRMS URN. There is also a column `digested_food` which will not have an associated URN, as it likely reflects unidentified prey species consumed -- this will have to be confirmed! This column will get added as a measurement linking directly to the salmon (Event Core). 

``` {r prey_occurrence, eval = FALSE}
# Create prey_id for each prey species in the stomach:
prey_occ <- prey %>%
  dplyr::select(eventID, prey, presence) %>%
  dplyr::rename(scientificName = prey) %>%
  mutate(occurrenceStatus = "present",
         occurrenceID = paste(eventID, prey$prey_id, sep = ":"))

prey_species <- unique(prey_occ$scientificName)
prey_species_scientificnames <- worrms::wm_records_names(prey_species)
prey_species_scientificnames <- dplyr::bind_rows(prey_species_scientificnames)

# Some species are not properly recorded in the dataset (i.e. th_longipes) and therefore are not recognized by the package. Of these species, we create a vector, with the proper names, and run this through the package as well. 

prey_species_scientificnames_manual <- data.frame(scientificName = as.character(c("Euphausia pacifica",
                                                                     "Sergestes pacificus",
                                                                     "Hyperia",
                                                                     "Thysanoessa spinifera",
                                                                     "Thysanoessa inspinata",
                                                                     "Thysanoessa longipes",
                                                                     "Vanadis",
                                                                     "Hormiphora cucumis",
                                                                     "Sebastes",
                                                                     "Microstomus pacificus")))

prey_species_scientificnames_manual <- worrms::wm_records_names(prey_species_scientificnames_manual$scientificName)
prey_species_scientificnames_manual <- dplyr::bind_rows(prey_species_scientificnames_manual)

# Two species still have to be added, as they are not found in WoRMS because they are not registered as marine_only species: Coelenterata and Sergestes pacificus. Look these up on WoRMS and add the relevant columns manually. 

prey_occ <- prey_occ %>%
  mutate(scientificNameID = case_when(
scientificName == "boreoteuthis_borealis" ~ "urn:lsid:marinespecies.org:taxname:342326",
# Boreoteuthis is not an accepted genus, Gonatopsis is the accepted version?
scientificName == "neocalanus_cristatus" ~ "urn:lsid:marinespecies.org:taxname:104470",
scientificName == "pisces" ~ "urn:lsid:marinespecies.org:taxname:1167",
scientificName == "tomopteris" ~ "urn:lsid:marinespecies.org:taxname:11676",
scientificName == "chuneola_major" ~ "urn:lsid:marinespecies.org:taxname:431286" ,
scientificName == "sergestes_pacificus" ~ " ",
# Is only the atlantic version accepted?
scientificName == "e_pacifica" ~ "urn:lsid:marinespecies.org:taxname:237851",
scientificName == "tarletonbeania_crenularis" ~ "urn:lsid:marinespecies.org:taxname:282927",
scientificName == "hyperia_sp" ~ "urn:lsid:marinespecies.org:taxname:101796",
scientificName == "clione_limacina" ~ "urn:lsid:marinespecies.org:taxname:139178",
scientificName == "th_spinifera" ~ "urn:lsid:marinespecies.org:taxname:237874",
# Assumption here is made that this concerns Thysanoessa spinifera
scientificName == "themisto_pacifica" ~ "urn:lsid:marinespecies.org:taxname:254453",
scientificName == "limacina_helicina" ~ "urn:lsid:marinespecies.org:taxname:140223",
scientificName == "primno_macropa" ~ "urn:lsid:marinespecies.org:taxname:180759",
scientificName == "th_inspinata" ~ "urn:lsid:marinespecies.org:taxname:237872",
# Assumption here is made that 'th' stands for Thysanoessa (genus)
scientificName == "coelenterata" ~ "urn:lsid:marinespecies.org:taxname:2",
# Coelenterata is a term encompassing the animal phyla Cnidaria and Ctenophora? 
# Therefore the lowest common rank is the kingdom Animalia
scientificName == "vanadis_sp" ~ "urn:lsid:marinespecies.org:taxname:129150",
scientificName == "sagitta_elegans" ~ "urn:lsid:marinespecies.org:taxname:105440",
# The accepted name is Parasagitta elegans
scientificName == "salpa_aspera" ~ "urn:lsid:marinespecies.org:taxname:137270",
scientificName == "cyclosalpa" ~ "urn:lsid:marinespecies.org:taxname:137227", 
scientificName == "th_longipes" ~ "urn:lsid:marinespecies.org:taxname:237873",
# Assumption is made that it is Thysanoessa longipes, Thysanoessa was the only genus in common between longipes, inspinata and spinifera. 
scientificName == "cephalopoda" ~ "urn:lsid:marinespecies.org:taxname:11707",
scientificName == "phronima_sedentaria" ~ "urn:lsid:marinespecies.org:taxname:103272",
scientificName == "oikopleura" ~ "urn:lsid:marinespecies.org:taxname:103367",
scientificName == "isopoda" ~ "urn:lsid:marinespecies.org:taxname:1131",
scientificName == "clio_pyramidata" ~ "urn:lsid:marinespecies.org:taxname:139033",
scientificName == "chormiphora_cucumis" ~ "urn:lsid:marinespecies.org:taxname:106382",
# Accepted name is Hormiphora cucumis?
scientificName == "symbolophorus_californiensis" ~ "urn:lsid:marinespecies.org:taxname:272733",
scientificName == "okutania_anonycha" ~ "urn:lsid:marinespecies.org:taxname:342285",
# Is the accepted name Berryteuthis anonychus?
scientificName == "sebastes" ~ "urn:lsid:marinespecies.org:taxname:126175",
scientificName == "mictostomus_pacificus" ~ "urn:lsid:marinespecies.org:taxname:274294")
# Spelling error? Accepted name is Microstomus pacificus?
) 

salmon_prey_occ <- prey_occ %>%
  select(eventID, occurrenceID, scientificName, scientificNameID, occurrenceStatus) %>%
  mutate(basisOfRecord = "HumanObservation") %>%
  filter(occurrenceStatus == "present")

# Make sure the folder path exists already (e.g. ./Salmon Diet/tidy_data)
write_csv(salmon_prey_occ, here("Salmon Diet", "tidy_data", "salmon_prey_occ.csv"))
drive_upload(here("Salmon Diet", "tidy_data", "salmon_prey_occ.csv"),
             path = "https://drive.google.com/drive/u/0/folders/1pGd2cuvdb25QX7CGm2wC81Emh5O-LdbR",
             name = "salmon_prey_occ.csv",
             overwrite = TRUE)
```

If we choose option B then the following chunk of code is also needed to create the Occurrence Core specifically for the salmon caught and whose stomach contents have been examined. Somehow through binding rows it duplicates some - I am unsure why. As a result, I've occassionally used distinct() to make sure only unique rows are provided.  

``` {r salmon_occ, eval = FALSE}
predator$occurrenceID <- paste(predator$eventID, "p", sep = ":")

predator_occ <- predator %>%
  dplyr::select(eventID, occurrenceID, species,
                n_stomachs) %>%
  dplyr::mutate(occurrenceStatus = "present",
                organismQuantityType = "stomachs") %>%
  dplyr::rename(scientificName = species,
                organismQuantity = n_stomachs) %>%
  mutate(scientificNameID = case_when(
scientificName == "Oncorhynchus gorbuscha" ~ "urn:lsid:marinespecies.org:taxname:127182",
scientificName == "Oncorhynchus kisutch" ~ "urn:lsid:marinespecies.org:taxname:127184",
scientificName == "Oncorhynchus keta" ~ "urn:lsid:marinespecies.org:taxname:127183",
scientificName == "Oncorhynchus nerka" ~ "urn:lsid:marinespecies.org:taxname:254569",
scientificName == "Oncorhynchus tschawytscha" ~ "urn:lsid:marinespecies.org:taxname:158075")) %>%
  # Accepted name has slightly different species name: O. tshawytscha
  select(eventID, occurrenceID, scientificName, scientificNameID, occurrenceStatus,
         organismQuantity, organismQuantityType) %>%
  distinct()

# Join the two occurrence cores:
diet_data_occ <- full_join(salmon_prey_occ, predator_occ)

# To reorder the eventID, use the following code:
order <- stringr::str_sort(diet_data_occ$occurrenceID, numeric=TRUE)
diet_data_occ <- diet_data_occ[match(order, diet_data_occ$occurrenceID),]
diet_data_occ <- diet_data_occ %>% select(eventID, occurrenceID, occurrenceStatus,
                                          scientificName, scientificNameID, 
                                          organismQuantity, organismQuantityType) %>%
  distinct()

write_csv(diet_data_occ, here("Salmon Diet", "tidy_data", "diet_data_occ.csv"))

# Join the event and the occurrence core:
salmondiet_event_occ <- left_join(salmon_event, diet_data_occ)
salmondiet_event_occ$associatedTaxa <- " "
salmondiet_event_occ$associatedTaxa <- ifelse(grepl("pr", salmondiet_event_occ$occurrenceID), 
paste("prey of: ", salmondiet_event_occ$eventID, sep = ""), "")
salmondiet_event_occ <- salmondiet_event_occ %>%
  mutate(institutionCode = " ",
         collectionCode = " ",
         catalogNumber = " ",
         preparations = " ")

write_csv(salmondiet_event_occ, here("Salmon Diet", "tidy_data", "salmondiet_event_occ.csv"))


# Make sure the folder path exists already (e.g. ./Salmon Diet/tidy_data)
write_csv(salmon_spp_occ, here("Salmon Diet", "tidy_data", "salmon_spp_occ.csv"))
drive_upload(here("Salmon Diet", "tidy_data", "salmon_spp_occ.csv"),
             path = "https://drive.google.com/drive/u/0/folders/1pGd2cuvdb25QX7CGm2wC81Emh5O-LdbR",
             name = "salmon_spp_occ.csv",
             overwrite = TRUE)
```

# measurementOrFact Cores

So even though we (currently) have one Occurrence Core for Salmon Diet data, there are two measurement Or Fact tables, one linking directly to the salmon (Event) and the other linking to the stomach content (prey occurrence). Let's start with the first extended measurement Or Fact Core, where we associate measurements of `fork length`, `mass`, `food mass`, `gut fullness index (GFI)`, `N stomachs`, `CFI` and possibly `digested food (unidentified)` to the salmon examined.  

``` {r, eval = FALSE}
salmon_spp_measurement <- salmon %>%
  select(measurementID = sample,
         fl_cm:cfi_percent_adj,
         digested_food) %>%
  pivot_longer(cols = fl_cm:digested_food, 
               names_to = "measurementType",
               values_to = "measurementValue") %>%
  mutate(measurementType = case_when(
           measurementType == "fl_cm" ~ "FL",
           measurementType == "mass_g" ~ "mass",
           measurementType == "food_mass_g" ~ "food_mass",
           measurementType == "gfi_percent" ~ "GFI",
           measurementType == "n_stomachs" ~ "count",
           measurementType == "cfi_percent_adj" ~ "CFI",
           measurementType == "digested_food" ~ "digested_food"),
    measurementID = paste(measurementID, measurementType, sep = ":"),
    measurementTypeID = case_when(
    measurementType == "FL" ~ " ",
    # But standard length: 	http://vocab.nerc.ac.uk/collection/P01/current/SL01XX01/
    measurementType == "mass" ~ "http://vocab.nerc.ac.uk/collection/P24/current/NMASS/",
    measurementType == "food_mass" ~ "http://vocab.nerc.ac.uk/collection/P24/current/NMASS/",
    measurementType == "GFI" ~ " ",
    measurementType == "count" ~ " ",
    measurementType == "CFI" ~ " ",
    measurementType == "digested_food" ~ "http://vocab.nerc.ac.uk/collection/P24/current/NMASS/"),
         measurementUnit = case_when(
    measurementType == "FL" ~ "cm",
    measurementType == "mass" ~ "g",
    measurementType == "food_mass" ~ "g",
    measurementType == "GFI" ~ "percent",
    measurementType == "count" ~ "stomachs",
    # This seems off to me - want to find a better alternative.
    measurementType == "CFI" ~ "percent",
    measurementType == "digested_food" ~ "g"),
         measurementUnitID = case_when(
    measurementUnit == "cm" ~ "http://vocab.nerc.ac.uk/collection/P06/current/ULCM/",
    measurementUnit == "g" ~ "http://vocab.nerc.ac.uk/collection/P06/current/UGRM/",
    measurementUnit == "percent" ~ "http://vocab.nerc.ac.uk/collection/P06/current/UPCT/",
    measurementUnit == "stomachs" ~ "http://vocab.nerc.ac.uk/collection/P06/current/UUUU/")) %>%
  select(measurementID, measurementType, measurementTypeID,
         measurementValue, measurementUnit, measurementUnitID)

# Write up csv file and upload to Google Drive folder
write_csv(salmon_spp_measurement, here("Salmon Diet", "tidy_data", "salmon_spp_measurement.csv"))
drive_upload(here("Salmon Diet", "tidy_data", "salmon_spp_measurement.csv"),
             path = "https://drive.google.com/drive/u/0/folders/1pGd2cuvdb25QX7CGm2wC81Emh5O-LdbR",
             name = "salmon_spp_eMoF.csv",
             overwrite = TRUE)
```

The second measurement Or Fact table will be created for the stomach content of the salmon species examined. The measurements associated to this Occurrence Core is `mass digested prey species`. First we filter out all the entries of species that were not recorded within a stomach (i.e., where measurementValue = NA)

``` {r, eval = FALSE}
salmon_prey_measurement <- salmon %>%
  select(measurementID = sample,
         boreoteuthis_borealis:mictostomus_pacificus) %>%
  select(-digested_food) %>%
  pivot_longer(cols = boreoteuthis_borealis:mictostomus_pacificus,
               names_to = "measurementType",
               values_to = "measurementValue") %>%
  filter(!is.na(measurementValue)) %>%
  mutate(measurementID = case_when(
    measurementType == "boreoteuthis_borealis" ~ paste(measurementID, "b.borealis", sep = ":"),
    measurementType == "neocalanus_cristatus" ~ paste(measurementID, "n.cristatus", sep = ":"),
    measurementType == "pisces" ~ paste(measurementID, "pisces", sep = ":"),
    measurementType == "tomopteris" ~ paste(measurementID, "tomopteris", sep = ":"),
    measurementType == "chuneola_major" ~ paste(measurementID, "c.major", sep = ":"),
    measurementType == "sergestes_pacificus" ~ paste(measurementID, "s.pacificus", sep = ":"),
    measurementType == "e_pacifica" ~ paste(measurementID, "e.pacifica", sep = ":"),
    measurementType == "tarletonbeania_crenularis" ~ paste(measurementID, "t.crenularis", sep = ":"),
    measurementType == "hyperia_sp" ~ paste(measurementID, "hyperia_sp", sep = ":"),
    measurementType == "clione_limacina" ~ paste(measurementID, "c.limacina", sep = ":"),
    measurementType == "th_spinifera" ~ paste(measurementID, "t.spinifera", sep = ":"),
    measurementType == "themisto_pacifica" ~ paste(measurementID, "t.pacifica", sep = ":"),
    measurementType == "limacina_helicina" ~ paste(measurementID, "l.helicina", sep = ":"),
    measurementType == "primno_macropa" ~ paste(measurementID, "p.macropa", sep = ":"),
    measurementType == "th_inspinata" ~ paste(measurementID, "t.inspinata", sep = ":"),
    measurementType == "coelenterata" ~ paste(measurementID, "coelenterata", sep = ":"),
    measurementType == "vanadis_sp" ~ paste(measurementID, "vanadis_sp", sep = ":"),
    measurementType == "sagitta_elegans" ~ paste(measurementID, "s.elegans", sep = ":"),
    measurementType == "salpa_aspera" ~ paste(measurementID, "s.aspera", sep = ":"),
    measurementType == "cyclosalpa" ~ paste(measurementID, "cyclosalpa", sep = ":"),
    measurementType == "th_longipes" ~ paste(measurementID, "t.longipes", sep = ":"),
    measurementType == "cephalopoda" ~ paste(measurementID, "cephalopoda", sep = ":"),
    measurementType == "phronima_sedentaria" ~ paste(measurementID, "p.sedentaria", sep = ":"),
    measurementType == "oikopleura" ~ paste(measurementID, "oikopleura", sep = ":"),
    measurementType == "isopoda" ~ paste(measurementID, "isopoda", sep = ":"),
    measurementType == "clio_pyramidata" ~ paste(measurementID, "c.pyramidata", sep = ":"),
    measurementType == "chormiphora_cucumis" ~ paste(measurementID, "c.cucumis", sep = ":"),
    measurementType == "symbolophorus_californiensis" ~ paste(measurementID, "s.californiensis", sep = ":"),
    measurementType == "okutania_anonycha" ~ paste(measurementID, "o.anonycha", sep = ":"),
    measurementType == "sebastes" ~ paste(measurementID, "sebastes", sep = ":"),
    measurementType == "mictostomus_pacificus" ~ paste(measurementID, "m.pacificus", sep = ":")),
  measurementUnit = "g",
  measurementUnitID = case_when(
    measurementUnit == "g" ~ "http://vocab.nerc.ac.uk/collection/P06/current/UGRM/"
  )
  )

# Write up csv file and upload to Google Drive folder
write_csv(salmon_prey_measurement, here("Salmon Diet", "tidy_data", "salmon_prey_measurement.csv"))
drive_upload(here("Salmon Diet", "tidy_data", "salmon_prey_measurement.csv"),
             path = "https://drive.google.com/drive/u/0/folders/1pGd2cuvdb25QX7CGm2wC81Emh5O-LdbR",
             name = "salmon_prey_eMoF.csv",
             overwrite = TRUE)
```

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">

Should these measurementOrFact cores be combined into a single MeasuremtOrFact Core? 

</div>

