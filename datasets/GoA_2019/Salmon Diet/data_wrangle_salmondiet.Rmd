---
title: "2019 IYS - Salmon Diet Data wrangle"
author: "Tim van der Stap"
date: "7/15/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(janitor)
library(readxl)
library(here)
library(parsedate)
library(googledrive)
library(uuid)
```

The raw data is stored on Google Drive. The first step is to download the file from Google Drive to a local folder on your computer's hard drive. 

``` {r file_download, eval = FALSE}
# Make sure your folder path exists already (e.g. ./Salmon Diet/raw_data)
drive_download("https://docs.google.com/spreadsheets/d/1E88ZXuiYIqjq4ABl2GDB7Kp0UAG-0tIM/edit#gid=2020388317", 
               path = here::here("Salmon Diet", "raw_data", 
                                 "GoA_fish diets_cleaned.xlsx"),
               overwrite = TRUE)
```

*** 

First step, is we wanted to see if the data in the salmon diet dataset matches data recorded in the pathogen dataset. The reason for this is that in the pathogen dataset, Floytags and MGL# are attached to the samples, but this appears to be missing in the salmon diet dataset. By cross-referencing, we can gain insight as to which diet data belongs to which Floytag or MGL#. Therefore, we also download the pathogen data.

``` {r file_download2, eval = FALSE}
# Make sure your folder path exists already (e.g. /Salmon Diet/raw_data)
drive_download("https://docs.google.com/spreadsheets/d/14YOHGGrU0zi--QHurgC6YVqlJ2GMPdoa/edit#gid=1919082779",
               path = here::here("Salmon Diet", "raw_data",
                                 "IYS_GoA_2019_fish_health_pathogen_detections.xlsx"),
               overwrite = TRUE)
```

Now read both files from the local folder, and make the minor adjustments in the data (column headers) needed to cross-reference columns `Trawl`, `Species` and `Mass`. 

``` {r, eval = FALSE}
salmon <- read_excel(here("Salmon Diet", "raw_data", 
                          "GoA_fish diets_cleaned.xlsx"),
                     sheet = "Diets_clean") %>%
  rename(Mass = `Mass, g`) %>%
  select(Trawl, Species, Mass)

pathogen <- read_excel(here("Salmon Diet", "raw_data",
                            "IYS_GoA_2019_fish_health_pathogen_detections.xlsx")) %>%
  mutate(Species = case_when(
    Species == "Coho" ~ "Oncorhynchus kisutch",
    Species == "Pink" ~ "Oncorhynchus gorbuscha",
    Species == "Chum" ~ "Oncorhynchus keta",
    Species == "Chinook" ~ "Oncorhynchus tschawytschka",
    Species == "Sockeye" ~ "Oncorhynchus nerka"
  )) %>%
  rename(Trawl = Set) %>%
  select(Trawl, Species, Mass)

# The rows where the is a match can be found using: 
match <- inner_join(salmon, pathogen) %>% mutate(check = "match")
# The rows where there is no match can be found using:
nomatch <- anti_join(salmon, pathogen) %>% mutate(check = "nomatch")
full <- rbind(match, nomatch)
full <- full[order(full$Trawl),]
```

Using the nrow() function we find that there are 52 rows where `Species`, `Trawl` and `Mass` data matches between the salmon diet data and the pathogen data, but 96 rows where there is no match. Unfortunately this means that, in the current state, we cannot cross-reference the pathogen and salmon data for the majority of the fish, and consequently we are not able to use Floytag or MGL# as a common parentEvent. 

***

# Event Core

When creating the different eventID layers, we assume that the column `Trawl` is synonymous to `Station` -- need to confirm this! Ideally, the salmon that were caught and dissected would have been given a Floytag or MGL#, so a distinction can be made between stomach content of different individuals of a same species in the same trawl. 

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">

To do: Confirm model structure for salmon diet data. Current problem: Multiple individuals of the same species were caught in a single trawl, however within the salmon diet dataset there is no column to indicate how these individual measurements are separate (i.e., no sampleID associated to each individual fish). Perhaps we should add a sampleID column ourselves, so that we can associate two occurrence cores (fish metrics / fish stomach content) to a single occurrence core?

</div>

The model structure for the salmon diet data is shown [here](https://app.diagrams.net/#G1CCBTro5std-UGbHdy6mVMa3QpZipGvIP). As can be seen, there are two occurrence cores that are linked, and connected to a common `eventID`. In the current set up, a salmon is also regarded as a 'sampling platform'. 

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">

**Food for thought**: should perhaps "Salmon caught" be an `event` layer, rather than an `Occurrence` (as is our current set up)? The measurements associated to the fish, such as `fork length`, `mass` etc can then be directly linked to the salmon individual. The reason why I currently included the salmon individual in the `Occurrence` layer is because I believe that allowed me to associate scientificName(ID) -- but perhaps this is not relevant? The focus of the dataset is _occurrence and prey mass_ in the stomach content of salmon. Thoughts?

</div>


``` {r data wrangle, eval = FALSE}
salmon <- read_excel(here("Salmon Diet", "raw_data", 
                       "GoA_fish diets_cleaned.xlsx"), 
                  sheet = "Diets_clean") %>%
  janitor::clean_names() %>%
  mutate(cruise = "GoA2019",
         station = paste(cruise, trawl, sep="_Stn"),
         trawl = paste(station, "trawl1", sep=":"),
         sample = paste(trawl, species, sep=":")
  )
```

No metadata is mentioned in the Salmon Diet data as to when and where the trawls took place. To connect the coordinates and time to the eventIDs, this information is taken from the trawl datasheet. Right now I am saving both these files in the Salmon Diet folder, but once all folders and scripts have been QC'd the location/time can be read straight from the Trawl-specific folder. For now, I'm afraid it would cause confusion when committing/pushing to GitHub. 

``` {r salmon_datetime, eval = FALSE}
drive_download(file = "https://docs.google.com/spreadsheets/d/1rtT6L5WSi_UiiXfoS95wnDqA8loc959T/edit#gid=668595086", 
               path = here::here("Salmon Diet", "raw_data", 
                                 "2019_GoA_Fish_data_Hakai.xlsx"),
               overwrite = TRUE)

trawl <- read_excel(here("Salmon Diet", "raw_data", "2019_GoA_Fish_data_Hakai.xlsx")) %>%
  mutate(eventDate = format_iso_8601(as.POSIXct(UTC_start)),
         eventDate = str_replace(eventDate, "\\+00:00", "Z")) %>%
  mutate(station = paste("GoA2019", NUMBER, sep = "_Stn"))
```

**Please note that the date and coordinates could change as the trawl data is not finalized.** 

``` {r salmondiet_event, eval = FALSE}
salmon_cruise <- salmon %>% 
  select(eventID = cruise) %>%
  distinct(eventID) %>%
  mutate(eventRemarks = "cruise")

salmon_station <- salmon %>%
  select(eventID = station,
         parentEventID = cruise) %>% 
  distinct(eventID, .keep_all = TRUE) %>% 
  mutate(eventRemarks = "station")

# Join date and coordinates to trawl. Remember that the date and coordinates are not from the Salmon Diet data sheet, but from the trawl data sheet. Minimum and maximum depth of the trawl be included here as well if the information becomes available. 
salmon_trawl <- salmon %>%
  left_join(select(
    trawl,
    station,
    UTC_start,
    X,
    Y
  )) %>%
  select(eventID = trawl,
         parentEventID = station,
         eventDate = UTC_start,
         decimalLatitude = Y,
         decimalLongitude = X) %>%
  distinct(eventID, .keep_all = TRUE) %>%
  mutate(eventRemarks = "trawl")

# The Salmon Diet data does not include information as to at what depths the trawls were conducted. Currently I believe this information is also not present in the general Trawl data. Should this information become available it should be connected to the general trawl information, along with info such as: volume water filter, speed at which the vessel was traveling during trawl, starting & finish lat/longs of trawl. 

# If an additional eventID layer is created for each salmon individual, the following lines of code are necessary. What this does is it treats every salmon data entry for which the stomach has been removed and examined as a sampling event, or, in other words, it treats the salmon like a sampling instrument! 
 
salmon_sample <- salmon %>% 
  select(eventID = sample,
         parentEventID = trawl) %>% 
  distinct(eventID, .keep_all = TRUE) %>% 
  mutate(eventRemarks = "sample")

# To connect them all together: 
salmon_event <- bind_rows(salmon_cruise,salmon_station,salmon_trawl, salmon_sample) %>%
  select(eventID, parentEventID:decimalLongitude, eventRemarks) %>%
  mutate(type = "HumanObservation")

# Should sample_type be included in the Event Core, under the heading samplingProtocol? 

# Make sure the folder path exists already (e.g. ./Salmon Diet/tidy_data)
write_csv(salmon_event, here("Salmon Diet", "tidy_data", "salmon_event.csv"))
drive_upload(here("Salmon Diet", "tidy_data", "salmon_event.csv"),
             path = "https://drive.google.com/drive/u/0/folders/1pGd2cuvdb25QX7CGm2wC81Emh5O-LdbR",
             name = "salmon_event.csv",
             overwrite = TRUE)
```

# Occurrence Core(s)

The current proposed set up would include two occurrence cores, with one occurrence core being connected to the other. Ideally, two occurrence cores would be connected to the `eventID` through a common occurrence core (Option 4 in DePooter et al 2017). Currently however this does not seem to be possible, as within the salmon diet datasheet there is no column designated to i.e., sampleID. The problem with this is that there are sometimes numerous individuals of the same species caught at a station/within a trawl, but these individuals have no defining tag. In the salmon diet dataset some data entries cover multiple stomachs examined (`N stomachs` > 1), and the associated fork length and mass appear to be averaged across multiple individuals. However, in the current set up it's sometimes not possible to identify which individuals this covers (i.e., no mentioning of Floytags or #MGL).

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 10px;}
</style>
<div class = "blue">

How do the scientists know which individual the stomach content belong to, asides from their data?
</div>

In one of the occurrence cores I think we should list all salmon species / individuals caught at a station/in a trawl. Measurements linked to the salmon species include: fork length, mass, food mass, gut fullness index (GFI), CFI adj %, `N stomachs` and `mass digested food` (but unidentified to a species). The assumption made here is that the column `N stomachs` refers to the number of stomachs examined, and therefore appears to work in a similar way to `count`. As the survey was set out to capture salmon, we assume that it is also of interest to see know which salmon species _have not_ been caught at each station, and therefore for each station we'll include whether each of the five salmon species were caught (present) or not (absent). Additionally, each salmon species will receive their own unique URN from [WoRMS](http://www.marinespecies.org). 

``` {r salmon_occ, eval = FALSE}
salmon_spp_occ <- salmon %>%
  complete(trawl, species, fill = list(n_stomachs = 0)) %>%
  rename(scientificName = species) %>% 
  mutate(occurrenceStatus = ifelse(n_stomachs > 0, "present", "absent"),
         occurrenceID = paste(trawl, scientificName, sep = ":"),
         scientificNameID = case_when(
scientificName == "Oncorhynchus gorbuscha" ~ "urn:lsid:marinespecies.org:taxname:127182",
scientificName == "Oncorhynchus kisutch" ~ "urn:lsid:marinespecies.org:taxname:127184",
scientificName == "Oncorhynchus keta" ~ "urn:lsid:marinespecies.org:taxname:127183",
scientificName == "Oncorhynchus nerka" ~ "urn:lsid:marinespecies.org:taxname:254569",
scientificName == "Oncorhynchus tschawytscha" ~ "urn:lsid:marinespecies.org:taxname:158075")) %>%
  # Accepted name has slightly different species name: O. tshawytscha
  rename(eventID = trawl) %>%
  select(eventID, occurrenceID, scientificName, scientificNameID, occurrenceStatus)

# Make sure the folder path exists already (e.g. ./Salmon Diet/tidy_data)
write_csv(salmon_spp_occ, here("Salmon Diet", "tidy_data", "salmon_spp_occ.csv"))
drive_upload(here("Salmon Diet", "tidy_data", "salmon_spp_occ.csv"),
             path = "https://drive.google.com/drive/u/0/folders/1pGd2cuvdb25QX7CGm2wC81Emh5O-LdbR",
             name = "salmon_spp_occ.csv",
             overwrite = TRUE)
```

The second occurrence core is connected to this 'primary' occurrence core, and consists of all the unique prey species consumed by the salmon species at each station. The measurements attached to these unique occurrences would be the presence or absence of a certain prey species in the stomach of a salmon, and the mass (g) of unique prey consumed. Each prey species will receive their own unique URN from [WoRMS](http://www.marinespecies.org/), if identified.

As all the prey species are listed as columns, we first have to investigate all the unique prey species consumed, as these will get their associated WoRMS URN. THere is also a column `digested_food` which will not have an associated URN, as it likely reflects unidentified prey species consumed -- this will have to be confirmed! This column will get added as a measurement to the _primary occurrence core_ (see model structure). 

``` {r prey_occurrence, eval = FALSE}
salmon_prey <- salmon  %>%
  pivot_longer(cols = boreoteuthis_borealis:mictostomus_pacificus, 
               names_to = "scientificName", values_to = "Mass") 
salmon_prey <- salmon_prey %>%
  mutate(occurrenceStatus = ifelse(is.na(salmon_prey$Mass), "absent", "present"),
         occurrenceID = paste(trawl, species, "stomach_content", scientificName, sep = ":"),
         scientificNameID = case_when(
scientificName == "boreoteuthis_borealis" ~ "urn:lsid:marinespecies.org:taxname:342326",
# Boreoteuthis is not an accepted genus, Gonatopsis is the accepted version?
scientificName == "neocalanus_cristatus" ~ "urn:lsid:marinespecies.org:taxname:104470",
scientificName == "pisces" ~ "urn:lsid:marinespecies.org:taxname:1167",
scientificName == "tomopteris" ~ "urn:lsid:marinespecies.org:taxname:11676",
scientificName == "chuneola_major" ~ "urn:lsid:marinespecies.org:taxname:431286" ,
scientificName == "sergestes_pacificus" ~ " ",
# Is only the atlantic version accepted?
scientificName == "e_pacifica" ~ "urn:lsid:marinespecies.org:taxname:237851",
scientificName == "tarletonbeania_crenularis" ~ "urn:lsid:marinespecies.org:taxname:282927",
scientificName == "hyperia_sp" ~ "urn:lsid:marinespecies.org:taxname:101796",
scientificName == "clione_limacina" ~ "urn:lsid:marinespecies.org:taxname:139178",
scientificName == "th_spinifera" ~ "urn:lsid:marinespecies.org:taxname:237874",
# Assumption here is made that this concerns Thysanoessa spinifera
scientificName == "themisto_pacifica" ~ "urn:lsid:marinespecies.org:taxname:254453",
scientificName == "limacina_helicina" ~ "urn:lsid:marinespecies.org:taxname:140223",
scientificName == "primno_macropa" ~ "urn:lsid:marinespecies.org:taxname:180759",
scientificName == "th_inspinata" ~ "urn:lsid:marinespecies.org:taxname:237872",
# Assumption here is made that 'th' stands for Thysanoessa (genus)
scientificName == "coelenterata" ~ "urn:lsid:marinespecies.org:taxname:2",
# Coelenterata is a term encompassing the animal phyla Cnidaria and Ctenophora? 
# Therefore the lowest common rank is the kingdom Animalia
scientificName == "vanadis_sp" ~ "urn:lsid:marinespecies.org:taxname:129150",
scientificName == "sagitta_elegans" ~ "urn:lsid:marinespecies.org:taxname:105440",
# The accepted name is Parasagitta elegans
scientificName == "salpa_aspera" ~ "urn:lsid:marinespecies.org:taxname:137270",
scientificName == "cyclosalpa" ~ "urn:lsid:marinespecies.org:taxname:137227", 
scientificName == "th_longipes" ~ "urn:lsid:marinespecies.org:taxname:237873",
# Assumption is made that it is Thysanoessa longipes, Thysanoessa was the only genus in common between longipes and spinifera. 
scientificName == "cephalopoda" ~ "urn:lsid:marinespecies.org:taxname:11707",
scientificName == "phronima_sedentaria" ~ "urn:lsid:marinespecies.org:taxname:103272",
scientificName == "oikopleura" ~ "urn:lsid:marinespecies.org:taxname:103367",
scientificName == "isopoda" ~ "urn:lsid:marinespecies.org:taxname:1131",
scientificName == "clio_pyramidata" ~ "urn:lsid:marinespecies.org:taxname:139033",
scientificName == "chormiphora_cucumis" ~ "urn:lsid:marinespecies.org:taxname:106382",
# Accepted name is Hormiphora cucumis?
scientificName == "symbolophorus_californiensis" ~ "urn:lsid:marinespecies.org:taxname:272733",
scientificName == "okutania_anonycha" ~ "urn:lsid:marinespecies.org:taxname:342285",
# Is the accepted name Berryteuthis anonychus?
scientificName == "sebastes" ~ "urn:lsid:marinespecies.org:taxname:126175",
scientificName == "mictostomus_pacificus" ~ "urn:lsid:marinespecies.org:taxname:274294")
# Spelling error? Accepted name is Microstomus pacificus?
) %>%
  rename(eventID = trawl)

salmon_prey_occ <- salmon_prey %>%
  select(eventID, occurrenceID, scientificName, scientificNameID, occurrenceStatus) %>%
  mutate(basisOfRecord = "HumanObservation")

# Make sure the folder path exists already (e.g. ./Salmon Diet/tidy_data)
write_csv(salmon_prey_occ, here("Salmon Diet", "tidy_data", "salmon_prey_occ.csv"))
drive_upload(here("Salmon Diet", "tidy_data", "salmon_prey_occ.csv"),
             path = "https://drive.google.com/drive/u/0/folders/1pGd2cuvdb25QX7CGm2wC81Emh5O-LdbR",
             name = "salmon_prey_occ.csv",
             overwrite = TRUE)
```

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

Q: Should these occurrence cores be combined into a single Occurrence Core using rbind()? 

</div>

# measurementOrFact Core(s)

So given that we have two occurrence cores for Salmon Diet data, there are also two measurementOrFact tables, each with their own associated measurements. Let's start with the first extended measurementOrFact Core, where we associate measurements of `fork length`, `mass`, `food mass`, `gut fullness index (GFI)`, `N stomachs`, `CFI` and possibly `digested food (unidentified)`. 

``` {r, eval = FALSE}
salmon_spp_measurement <- salmon %>%
  select(occurrenceID = sample,
         fl_cm:cfi_percent_adj,
         digested_food) %>%
  pivot_longer(cols = fl_cm:cfi_percent_adj, 
               names_to = "measurementType",
               values_to = "measurementValue") %>%
  mutate(measurementID = case_when(
    measurementType == "fl_cm" ~ paste(occurrenceID, "FL", sep = ":"),
    measurementType == "mass_g" ~ paste(occurrenceID, "mass", sep = ":"),
    measurementType == "food_mass_g" ~ paste(occurrenceID, "food_mass", sep = ":"),
    measurementType == "gfi_percent" ~ paste(occurrenceID, "GFI", sep = ":"),
    measurementType == "n_stomachs" ~ paste(occurrenceID, "n_stomachs", sep = ":"),
    measurementType == "cfi_percent_adj" ~ paste(occurrenceID, "CFI", sep = ":"),
    measurementType == "digested_food" ~ paste(occurrenceID, "food_digested", sep = ":")),
         measurementTypeID = case_when(
    measurementType == "fl_cm" ~ " ",
    # But standard length: 	http://vocab.nerc.ac.uk/collection/P01/current/SL01XX01/
    measurementType == "mass_g" ~ "http://vocab.nerc.ac.uk/collection/P24/current/NMASS/",
    measurementType == "food_mass_g" ~ "http://vocab.nerc.ac.uk/collection/P24/current/NMASS/",
    measurementType == "gfi_percent" ~ " ",
    measurementType == "n_stomachs" ~ " ",
    measurementType == "cfi_percent_adj" ~ " ",
    measurementType == "digested_food" ~ "http://vocab.nerc.ac.uk/collection/P24/current/NMASS/"),
         measurementUnit = case_when(
    measurementType == "fl_cm" ~ "cm",
    measurementType == "mass_g" ~ "g",
    measurementType == "food_mass_g" ~ "g",
    measurementType == "gfi_percent" ~ "percent",
    measurementType == "n_stomachs" ~ "stomachs",
    # This seems off to me - want to find a better alternative.
    measurementType == "cfi_percent_adj" ~ "percent",
    measurementType == "digested_food" ~ "g"),
         measurementUnitID = case_when(
    measurementUnit == "cm" ~ "http://vocab.nerc.ac.uk/collection/P06/current/ULCM/",
    measurementUnit == "g" ~ "http://vocab.nerc.ac.uk/collection/P06/current/UGRM/",
    measurementUnit == "percent" ~ "http://vocab.nerc.ac.uk/collection/P06/current/UPCT/",
    measurementUnit == "stomachs" ~ "http://vocab.nerc.ac.uk/collection/P06/current/UUUU/")) %>%
  select(measurementID, measurementType, measurementTypeID,
         measurementValue, measurementUnit, measurementUnitID)

# Write up csv file and upload to Google Drive folder
write_csv(salmon_spp_measurement, here("Salmon Diet", "tidy_data", "salmon_spp_measurement.csv"))
drive_upload(here("Salmon Diet", "tidy_data", "salmon_spp_measurement.csv"),
             path = "https://drive.google.com/drive/u/0/folders/1pGd2cuvdb25QX7CGm2wC81Emh5O-LdbR",
             name = "salmon_spp_eMoF.csv",
             overwrite = TRUE)
```

The second measurement Or Fact table will be created for the stomach content of the salmon species examined. The measurements associated to this Occurrence Core is `mass digested prey species`. The `presence/absence` of a prey species in an occurrence has already been determined in the Occurrence core. 

``` {r, eval = FALSE}
salmon_prey_measurement <- salmon %>%
  select(occurrenceID = sample,
         boreoteuthis_borealis:mictostomus_pacificus) %>%
  select(-digested_food) %>%
  pivot_longer(cols = boreoteuthis_borealis:mictostomus_pacificus,
               names_to = "measurementType",
               values_to = "measurementValue") %>%
  mutate(measurementID = case_when(
    measurementType == "boreoteuthis_borealis" ~ paste(occurrenceID, "b.borealis", sep = ":"),
    measurementType == "neocalanus_cristatus" ~ paste(occurrenceID, "n.cristatus", sep = ":"),
    measurementType == "pisces" ~ paste(occurrenceID, "pisces", sep = ":"),
    measurementType == "tomopteris" ~ paste(occurrenceID, "tomopteris", sep = ":"),
    measurementType == "chuneola_major" ~ paste(occurrenceID, "c.major", sep = ":"),
    measurementType == "sergestes_pacificus" ~ paste(occurrenceID, "s.pacificus", sep = ":"),
    measurementType == "e_pacifica" ~ paste(occurrenceID, "e.pacifica", sep = ":"),
    measurementType == "tarletonbeania_crenularis" ~ paste(occurrenceID, "t.crenularis", sep = ":"),
    measurementType == "hyperia_sp" ~ paste(occurrenceID, "hyperia_sp", sep = ":"),
    measurementType == "clione_limacina" ~ paste(occurrenceID, "c.limacina", sep = ":"),
    measurementType == "th_spinifera" ~ paste(occurrenceID, "t.spinifera", sep = ":"),
    measurementType == "themisto_pacifica" ~ paste(occurrenceID, "t.pacifica", sep = ":"),
    measurementType == "limacina_helicina" ~ paste(occurrenceID, "l.helicina", sep = ":"),
    measurementType == "primno_macropa" ~ paste(occurrenceID, "p.macropa", sep = ":"),
    measurementType == "th_inspinata" ~ paste(occurrenceID, "t.inspinata", sep = ":"),
    measurementType == "coelenterata" ~ paste(occurrenceID, "coelenterata", sep = ":"),
    measurementType == "vanadis_sp" ~ paste(occurrenceID, "vanadis_sp", sep = ":"),
    measurementType == "sagitta_elegans" ~ paste(occurrenceID, "s.elegans", sep = ":"),
    measurementType == "salpa_aspera" ~ paste(occurrenceID, "s.aspera", sep = ":"),
    measurementType == "cyclosalpa" ~ paste(occurrenceID, "cyclosalpa", sep = ":"),
    measurementType == "th_longipes" ~ paste(occurrenceID, "t.longipes", sep = ":"),
    measurementType == "cephalopoda" ~ paste(occurrenceID, "cephalopoda", sep = ":"),
    measurementType == "phronima_sedentaria" ~ paste(occurrenceID, "p.sedentaria", sep = ":"),
    measurementType == "oikopleura" ~ paste(occurrenceID, "oikopleura", sep = ":"),
    measurementType == "isopoda" ~ paste(occurrenceID, "isopoda", sep = ":"),
    measurementType == "clio_pyramidata" ~ paste(occurrenceID, "c.pyramidata", sep = ":"),
    measurementType == "chormiphora_cucumis" ~ paste(occurrenceID, "c.cucumis", sep = ":"),
    measurementType == "symbolophorus_californiensis" ~ paste(occurrenceID, "s.californiensis", sep = ":"),
    measurementType == "okutania_anonycha" ~ paste(occurrenceID, "o.anonycha", sep = ":"),
    measurementType == "sebastes" ~ paste(occurrenceID, "sebastes", sep = ":"),
    measurementType == "mictostomus_pacificus" ~ paste(occurrenceID, "m.pacificus", sep = ":")),
  measurementUnit = "g",
  measurementUnitID = case_when(
    measurementUnit == "g" ~ "http://vocab.nerc.ac.uk/collection/P06/current/UGRM/"
  )
  )

# Write up csv file and upload to Google Drive folder
write_csv(salmon_prey_measurement, here("Salmon Diet", "tidy_data", "salmon_prey_measurement.csv"))
drive_upload(here("Salmon Diet", "tidy_data", "salmon_prey_measurement.csv"),
             path = "https://drive.google.com/drive/u/0/folders/1pGd2cuvdb25QX7CGm2wC81Emh5O-LdbR",
             name = "salmon_prey_eMoF.csv",
             overwrite = TRUE)
```

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

Q: Similar to the question above regarding the occurrence cores, should these measurementOrFact cores be combined into a single MeasuremtOrFact Core? 

</div>

